<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>数字身份系统</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--标准mui.css-->
		<link rel="stylesheet" href="css/mui.min.css">
		<!--App自定义的css-->
		<link rel="stylesheet" type="text/css" href="css/app.css" />
		<!--我的css-->
		<link rel="stylesheet" type="text/css" href="css/iconfont_number.css" /
		<link rel="stylesheet" type="text/css" href="css/iconfont_myinfo.css" />
	</head>

	<body>
		<div id="offCanvasWrapper" class="mui-off-canvas-wrap mui-draggable">
			<!--主界面部分-->
			<div class="mui-inner-wrap">
				<!-- 菜单容器 -->
	            <aside class="mui-off-canvas-left" id="offCanvasSide">
	                <div class="mui-scroll-wrapper">
	                    <div class="mui-scroll">
	                        <!-- 菜单具体展示内容 -->
	                        
	                    </div>
	                </div>
	            </aside>
				<!--头部内容-->
				<div class="mui-bar mui-bar-nav" id="head-contract">
					<a href="#contractPopover" style="font-size: 35px; margin-top: -5px;"></a>
					<a class=" mui-pull-right mui-btn-link" id="showList">编辑</a>
					<h1 class="mui-title mui-pull-left">我的数字凭证</h1>
				</div>

				<div class="mui-bar mui-bar-nav" id="head-me">
					<a href="#mypopover" id="openMyPopover" class="mui-icon iconfont_myinfo iconweb_erweima mui-pull-right"></a>
					<h1 class="mui-title mui-pull-left">设置</h1>
				</div>
				<div class="mui-bar mui-bar-nav" id="head-community">
					<h1 class="mui-title mui-pull-left">申请数字证明</h1>
				</div>
				<div class="mui-bar mui-bar-nav" id="head-index">
					<a href="#offCanvasSide" class="mui-icon mui-action-menu mui-icon-bars mui-pull-left"></a>
					<h1 class="mui-title mui-pull-left">申请数字证明</h1>
				</div>
				<!--底部菜单-->
				<nav class="mui-bar mui-bar-tab">
					<a class="mui-tab-item mui-active" id="tab-index" href="#tabbar-1">
						<span class="mui-icon iconfont icon-instruction"></span>
						<span class="mui-tab-label">申请数字证明</span>
					</a>
					<a class="mui-tab-item" id="tab-contract" href="#tabbar-2">
						<span class="mui-icon iconfont icon-addresslist"></span>
						<span class="mui-tab-label">我的数字凭证</span>
					</a>
					<a class="mui-tab-item" id="tab-community">
						<span class="mui-icon iconfont icon-scanQR"></span>
						<span class="mui-tab-label">扫一扫</span>
					</a>
					<a class="mui-tab-item" id="tab-me" href="#tabbar-4">
						<span class="mui-icon mui-icon-gear"></span>
						<span class="mui-tab-label">设置</span>
					</a>
				</nav>
				<!--非侧滑内容-->
				<div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper">
					<div class="mui-scroll">
						<!--申请数字证明-->
						<div id="tabbar-1" class="mui-control-content mui-active">
							<ul class="mui-table-view" id="papers">
							    <li class="mui-table-view-cell">
							        <a href="#sendApplyForm1" id="sendApplyForm1" class="mui-navigate-right">收入证明</a>
							    </li>
							    <li class="mui-table-view-cell">
							        <a href="#sendApplyForm2" id="sendApplyForm2" class="mui-navigate-right">存款证明</a>
							    </li>
							    <li class="mui-table-view-cell">
							        <a href="#sendApplyForm3" id="sendApplyForm3" class="mui-navigate-right">房产证明</a>
							    </li>
							</ul>
						</div>
						<!--我的数字凭证-->
						<div id="tabbar-2" class="mui-control-content">
							<ul class="mui-table-view" id="papers-list">
							</ul>
							
						</div>
						<!--扫一扫-->
						<div class="mui-control-content">
							<ul class="mui-table-view" id="papers">
								<a id="barcode" href="#barcode" class="mui-navigate-right"></a>
							    <!--<li class="mui-table-view-cell">
							        
							        <span class="item">
							          <div class="chs">二维码扫描</div>
							        </span>
							        
							    </li>-->
							</ul>
						</div>
						<div id="tabbar-4" class="mui-control-content">

							<div class="mytitleinfo">
								<span class="logo">
									<img src="./img/myinfo/nanfei.png" align="right" id="myinfo-icon"/>
								</span>
								<div class="title_text">

									<p class="p1" id="myinfo-user">SBSA</p>
									<p class="p2">
										状态：正常
									</p>
									<p class="p1" id="myinfo-name">南非标准银行</p>

								</div>
								<div class="title_img">
									<img src="./img/myinfo/gaojirenzhen.png" />
								</div>

							</div>
							<ul class="mui-table-view">

								<li class="mui-table-view-cell">

									<a class="mui-navigate-right">
										<span class="mui-icon iconfont_myinfo iconweb_mobanguanli iconstyle">
									</span>
										<span class="li_text_style">凭证模板</span>
									</a>
								</li>
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right">
										<span class="mui-icon iconfont_myinfo iconweb_kehu iconstyle">
									</span>
										<span class="li_text_style">
									重要客户
									</span>
									</a>
								</li>
							</ul>
							<ul class="mui-table-view" style="margin-top: 25px;">
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right">
										<span class="mui-icon iconfont_myinfo iconweb_file iconstyle">
									</span>
										<span class="li_text_style">
									黑白名单管理
									</span>
									</a>
								</li>
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right">
										<span class="mui-icon iconfont_myinfo iconweb_iphone iconstyle">
									</span>
										<span class="li_text_style">
									支付账户管理
									</span>
									</a>
								</li>
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right">
										<span class="mui-icon iconfont_myinfo iconweb_qiabao iconstyle">
									</span>
										<span class="li_text_style">
									卡包
									</span>
									</a>
								</li>
							</ul>
							<ul class="mui-table-view" style="margin-top: 25px;">
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right">
										<span class="mui-icon iconfont_myinfo iconweb_shequ iconstyle">
									</span>
										<span class="li_text_style">
									社区中心管理
									</span>
									</a>
								</li>
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right">
										<span class="mui-icon iconfont_myinfo iconweb_kefu iconstyle">
									</span>
										<span class="li_text_style">
									我的客服
									</span>
									</a>
								</li>
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right">
										<span class="mui-icon iconfont_myinfo iconweb_xinjian iconstyle">
									</span>
										<span class="li_text_style">
									发件人信息
									</span>
									</a>
								</li>
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right">
										<span class="mui-icon iconfont_myinfo iconweb_fuli iconstyle">
									</span>
										<span class="li_text_style">
									福利社
									</span>
									</a>
								</li>
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right">
										<span class="mui-icon iconfont_myinfo iconweb_yaoqing iconstyle">
									</span>
										<span class="li_text_style">
									邀请
									</span>
									</a>
								</li>
							</ul>
							<ul class="mui-table-view" style="margin-top: 25px;">
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right">
										<span class="mui-icon iconfont_myinfo iconweb_shezhi iconstyle">
									</span>
										<span class="li_text_style">
									设置
									</span>
									</a>
								</li>
							</ul>
							<ul class="mui-table-view" style="margin-top: 25px; margin-bottom: 40px;" id="logout">
								<li class="mui-table-view-cell">
									<a id="exit" style="text-align: center;color: #FF3B30;">
										退出登录
									</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
				<!-- off-canvas backdrop -->
				<div class="mui-off-canvas-backdrop"></div>
			</div>
		</div>
	</body>
	<script src="js/mui.min.js"></script>
	<script src="js/app3.js"></script>
	<script src="js/app2.js"></script>
	<script src="js/jquery-3.4.1.min.js"></script>
	<script type="text/javascript">
		var	weId = JSON.parse(localStorage.weId);
		document.getElementById("sendApplyForm1").addEventListener('tap', function()
		{
			var papersName = document.getElementById("sendApplyForm1").text;
			mui.openWindow({
			    url: 'applyForm.html', 
			    id:'applyForm',
			    extras:{
		      		papersName: papersName
		    	}
			});
			
		});
		document.getElementById("sendApplyForm2").addEventListener('tap', function()
		{
			var papersName = document.getElementById("sendApplyForm2").text;
			mui.openWindow({
			    url: 'applyForm.html', 
			    id:'applyForm',
			    extras:{
		      		papersName: papersName
		    	}
			});
			
		});
		document.getElementById("sendApplyForm3").addEventListener('tap', function()
		{
			var papersName = document.getElementById("sendApplyForm3").text;
			mui.openWindow({
			    url: 'applyForm.html', 
			    id:'applyForm',
			    extras:{
		      		papersName: papersName
		    	}
			});
			
		});
		//多凭证验证
		document.getElementById("showList").addEventListener('tap', function()
		{	
			mui.ajax('http://129.204.253.9:6001/weid/api/invoke', {
				dataType:'json',
				data :{
				    "functionArg": {
				    	"invokerWeId":weId
				    },
				    "transactionArg": {
				    },
				    "functionName": "getAllCredential",
				    "v": "1.0.0"
				},
				type:'post',//HTTP请求类型
				timeout:5000,//超时时间设置为10秒； 
				crossDomain:true,
				headers:{
					'Access-Control-Allow-Origin':'*',
					'Access-Control-Allow-Headers':'Content-Type,Content-Length,Authorization,Accept,X-Requested-With,yourHeaderFeild',
					'Access-Control-Allow-Methods':'PUT,POST,GET,DELETE,OPTIONS',
					'X-Powered-By':'3.2.1',
					'Content-Type':'application/json;charset=utf-8'
				},
				success:function(data){
					console.log(JSON.stringify(data));
					if(data.errorCode == '0'){
						var papersList = JSON.stringify(data.respBody);
						mui.openWindow({
						    url: 'checkboxList.html', 
						    id:'checkboxList',
						    extras:{
					      		papersList: papersList
					    	}
						});
					} else {
						mui.alert(data.errorMsg);
					}
					
				},
				error:function(xhr,type,errorThrown){
					//异常处理；
					mui.alert("数据请求失败:"+type);
					
				}
			});

			
		});
		//扫码
		document.getElementById("tab-community").addEventListener('tap', function()
		{
			var papersName = document.getElementById("barcode").text;
			mui.openWindow({
			    url: 'barcode.html', 
			    id:'barcode',
			});
			
		});
		
		//查看凭证列表
		document.getElementById("tab-contract").addEventListener('tap',function(){
			mui.ajax('http://129.204.253.9:6001/weid/api/invoke', {
				dataType:'json',
				data :{
				    "functionArg": {
				    	"invokerWeId":weId
				    },
				    "transactionArg": {
				    },
				    "functionName": "getAllCredential",
				    "v": "1.0.0"
				},
				type:'post',//HTTP请求类型
				timeout:5000,//超时时间设置为10秒； 
				crossDomain:true,
				headers:{
					'Access-Control-Allow-Origin':'*',
					'Access-Control-Allow-Headers':'Content-Type,Content-Length,Authorization,Accept,X-Requested-With,yourHeaderFeild',
					'Access-Control-Allow-Methods':'PUT,POST,GET,DELETE,OPTIONS',
					'X-Powered-By':'3.2.1',
					'Content-Type':'application/json;charset=utf-8'
				},
				success:function(data){
					console.log(JSON.stringify(data));
					if(data.errorCode == '0'){
						var papersList = data.respBody;
						var table = document.body.querySelector('#papers-list');
						var str = "";//定义用于拼接的字符串
						document.getElementById("papers-list").innerHTML="";
				        for (var i = 0; i < papersList.length; i++) {
				         	//拼接表格的行和列
				         	//mui.alert(papersList[i].id);
				         	//str = " <li class='mui-table-view-cell'>" + "<a id='applyForm' class='mui-navigate-right'>" +papersList[i].id +"</a></li>";
				         	//追加到table中
				        	//$("#papers-list").append(str); 
				        	var item = papersList[i];
				        	papersId = item.id;
				        	papersName = item.claim.papersName;
				        	bank= item.claim.bank;
				        	issuanceDate = formatDate("yyyy-MM-ddThh:mm:ssZ",item.issuanceDate);
				        	var li = document.createElement('li');
							li.className = 'papers-list-cell';
							//li.id = 'detail';
				        	li.papersId = papersId;
				        	li.innerHTML =
				        	'<li class="mui-table-view-cell">'+
				        	'<a id="detail" class="mui-navigate-right">' +papersName +"---"+bank+"---"+formatDate("yyyy-MM-dd hh:mm:ss", issuanceDate)+'</a></li>';
				        	table.insertBefore(li, table.firstChild);
				        }
					} else {
						mui.alert(data.errorMsg);
					}
					
				},
				error:function(xhr,type,errorThrown){
					//异常处理；
					mui.alert("数据请求失败:"+type);
					
				}
			});
		});
		mui("#papers-list").on('tap', '.papers-list-cell', function(e) {
			var papersId = this.papersId;
			//alert(papersId);
		    console.log("papersId:"+papersId);
		    //mui.alert(papersId)
			mui.ajax('http://129.204.253.9:6001/weid/api/invoke', {
				dataType:'json',
				data :{
				    "functionArg": {
				        "id": papersId
				    },
				    "transactionArg": {},
				    "functionName": "getCredentialDetail",
				    "v": "1.0.0"
				},
				type:'post',//HTTP请求类型
				timeout:5000,//超时时间设置为10秒； 
				crossDomain:true,
				headers:{
					'Access-Control-Allow-Origin':'*',
					'Access-Control-Allow-Headers':'Content-Type,Content-Length,Authorization,Accept,X-Requested-With,yourHeaderFeild',
					'Access-Control-Allow-Methods':'PUT,POST,GET,DELETE,OPTIONS',
					'X-Powered-By':'3.2.1',
					'Content-Type':'application/json;charset=utf-8'
				},
				success:function(data){
					var respBody = data.respBody;
					console.log("详情data:"+JSON.stringify(data));
					console.log("respBody:"+JSON.stringify(respBody));
					var str = JSON.stringify(respBody);  
				    localStorage.papers = str;  
				    //localStorage.qrytype = qrytype;
				    
					mui.openWindow({
					    url: 'detail.html', 
					    id:'detail',
//					    extras:{
//				      		papers: str
//				    	}
					});
				},
				error:function(xhr,type,errorThrown){
					//异常处理；
					mui.alert("数据请求失败:"+type);
					
		//			var data = {"errorCode":"0", "mailList":[{"sender":"工商银行001","mailID":"0001","receiver":["mo","hai"],"subject":"test","templateID":"Temp123","sendDate":"2019-07-10 00:01:01"},{"sender":"工商银行002","mailID":"0002","receiver":["mo","hai"],"subject":"test","templateID":"Temp123","sendDate":"2019-07-10 00:01:02"},{"sender":"工商银行003","mailID":"0003","receiver":["mo","hai"],"subject":"test","templateID":"Temp123","sendDate":"2019-07-10 00:01:03"},{"sender":"工商银行004","mailID":"0004","receiver":["mo","hai"],"subject":"test","templateID":"Temp123","sendDate":"2019-07-10 00:01:04"},{"sender":"工商银行005","mailID":"0005","receiver":["mo","hai"],"subject":"test","templateID":"Temp123","sendDate":"2019-07-10 00:01:05"},{"sender":"工商银行006","mailID":"0006","receiver":["mo","hai"],"subject":"test","templateID":"Temp123","sendDate":"2019-07-10 00:01:06"},{"sender":"工商银行007","mailID":"0007","receiver":["mo","hai"],"subject":"test","templateID":"Temp123","sendDate":"2019-07-10 00:01:07"}]};
				}
			});
		});
		//格式化时间 yyyy-MM-dd hh:mm:ss
		function formatDate(fmt, date) {
		    date = new Date(date);
		    var o = {
		        "M+": date.getMonth() + 1, //月份
		        "d+": date.getDate(), //日
		        "h+": date.getHours(), //小时
		        "m+": date.getMinutes(), //分
		        "s+": date.getSeconds(), //秒
		        "q+": Math.floor((date.getMonth() + 3) / 3), //季度
		        "S": date.getMilliseconds() //毫秒
		    };
		    if (/(y+)/.test(fmt))
		        fmt = fmt.replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
		    for (var k in o)
		        if (new RegExp("(" + k + ")").test(fmt))
		            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
		    return fmt;
		}
	</script>
</html>